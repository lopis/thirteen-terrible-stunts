let style="";class StateMachine{constructor(a,...b){this.currentState=a;this.currentState.onEnter?.(...b)}setState(a,...b){this.currentState.onLeave?.();this.currentState=a;this.currentState.onEnter?.(...b)}getState(){return this.currentState}}let gameStateMachine;function createGameStateMachine(a,...b){gameStateMachine=new StateMachine(a,...b)}
class Controls{constructor(){this.isEscape=this.isConfirm=this.isRight=this.isLeft=this.isDown=this.isUp=!1;this.keyMap=new Map;this.previousState={isUp:this.isUp,isDown:this.isDown,isConfirm:this.isConfirm,isEscape:this.isEscape};document.addEventListener("keydown",a=>this.toggleKey(a,!0));document.addEventListener("keyup",a=>this.toggleKey(a,!1));this.inputDirection=new DOMPoint}queryController(){this.previousState.isUp=this.isUp;this.previousState.isDown=this.isDown;this.previousState.isConfirm=
this.isConfirm;this.previousState.isEscape=this.isEscape;let a=navigator.getGamepads()[0],b=this.keyMap.get("KeyA")||this.keyMap.get("ArrowLeft")||a?.buttons[14].pressed?-1:0,c=this.keyMap.get("KeyD")||this.keyMap.get("ArrowRight")||a?.buttons[15].pressed?1:0,d=this.keyMap.get("KeyW")||this.keyMap.get("ArrowUp")||a?.buttons[12].pressed?-1:0,e=this.keyMap.get("KeyS")||this.keyMap.get("ArrowDown")||a?.buttons[13].pressed?1:0;this.inputDirection.x=b+c||a?.axes[0]||0;this.inputDirection.y=d+e||a?.axes[1]||
0;.1>Math.hypot(this.inputDirection.x,this.inputDirection.y)&&(this.inputDirection.x=0,this.inputDirection.y=0);this.isUp=0>this.inputDirection.y;this.isDown=0<this.inputDirection.y;this.isLeft=0>this.inputDirection.x;this.isRight=0<this.inputDirection.x;this.isConfirm=!!(this.keyMap.get("Enter")||a?.buttons[0].pressed||a?.buttons[9].pressed);(this.isEscape=!(!this.keyMap.get("Escape")&&!a?.buttons[8].pressed))&&gameStateMachine.setState(menuState)}toggleKey(a,b){this.keyMap.set(a.code,b)}}
let controls=new Controls;var bodyStyles=window.getComputedStyle(document.body);bodyStyles.getPropertyValue("--color-white");bodyStyles.getPropertyValue("--color-1");bodyStyles.getPropertyValue("--color-2");bodyStyles.getPropertyValue("--color-3");bodyStyles.getPropertyValue("--color-4");bodyStyles.getPropertyValue("--color-5");bodyStyles.getPropertyValue("--color-6");bodyStyles.getPropertyValue("--color-dark");
class DrawEngine{constructor(){let a=()=>{c2d.height=c2d.clientHeight;c2d.width=c2d.clientWidth};window.addEventListener("resize",a);a()}}new DrawEngine;class GameData{constructor(){this.maxLevel=this.level=0}}
let gameData=new GameData,melodies=[[6,5,3,3,5,5,0,5,-2,0,-2,0,6,3,2,3],[4,3,5,4,3,5,6,4,3,5,4,3,5,6,4,3],[3,2,3,6,0,-2,0,-2,5,0,5,5,3,3,5,6]],baseTracks=[[2,3,2.5,4],[4,3.5,3,2.5],[4,2.5,3,2]],f=(a,b)=>c=>Math.sin(60*Math.pow(10,-(c+1)/2048%8))/8+Math.tan(Math.cbrt(Math.sin(c*a[c>>13&15]/30)))/[2,3,4,6,8,12,16,24][c/[1,1.5][c>>12&1]>>10&7]/32+Math.cbrt(Math.asin(Math.sin(c/b[c>>16&3]/10)))/64,SAMPLE_RATE=32E3;
class BytebeatPlayer{constructor(){this.source=null;this.buffers=[];this.ctx=new AudioContext;this.createBuffers()}createBuffers(){for(let a=0;3>a;a++){let b=melodies[a%melodies.length],c=baseTracks[a%melodies.length],d=(b.length+.4)*SAMPLE_RATE/2,e=this.ctx.createBuffer(1,d,SAMPLE_RATE),h=e.getChannelData(0);for(let g=0;g<d;g++)h[g]=f(b,c)(g);this.buffers.push(e)}}start(){this.ctx=new AudioContext;this.source=this.ctx.createBufferSource();this.source.buffer=this.buffers[gameData.level];this.source.connect(this.ctx.destination);
this.source.loop=!0;this.source.start()}stop(){this?.source?.stop()}}let player,initAudio=()=>{player=new BytebeatPlayer},stopAudio=()=>{player&&player.stop()};
class MenuState{constructor(){this.selectedButton=0;this.buttons=[this.startGame,this.continueGame]}onEnter(){stopAudio()}onLeave(){}onUpdate(){this.updateControls()}updateControls(){controls.isUp&&!controls.previousState.isUp&&(this.selectedButton--,0>this.selectedButton&&(this.selectedButton=this.buttons.length-1));controls.isDown&&!controls.previousState.isDown&&(this.selectedButton++,this.selectedButton>=this.buttons.length&&(this.selectedButton=0));if(controls.isConfirm&&!controls.previousState.isConfirm){let a=
this.buttons[this.selectedButton];a&&a()}}startGame(){}continueGame(){}}let menuState=new MenuState;document.querySelector('link[type="image/x-icon"]').href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E\ud83d\udd35%3C/text%3E%3C/svg%3E";createGameStateMachine(menuState);let previousTime=0,fpsBacklog=[];initAudio();
(function draw(a){let c=a-previousTime;previousTime=a;controls.queryController();gameStateMachine.getState().onUpdate(c);fpsBacklog.push(1E3/c);15===fpsBacklog.length&&(fps.innerHTML=`${Math.round(fpsBacklog.reduce((d,e)=>d+e)/15)} FPS`,fpsBacklog=[]);requestAnimationFrame(draw)})(0);
