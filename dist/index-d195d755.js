let g=a=>a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d])$/i,(b,c,d,e,f)=>"#"+c+c+d+d+e+e+f+f).substring(1).match(/.{2}/g).map(b=>parseInt(b,16)),k=" 2rwzo  58jgo 55eyo    34ao 7k b28 m0 20o0o 9a7vy jbmjj jhza7 ivhmm etrs7 ju8e7 jalrz jyn66 jwdj3 jwdlv 2t8g 2t8s 34yo lskg m2yo jf4lo jysjy 98ruh j8htq 9v7zj j8d32 ju78f ju8t4 9ul2n g44e1 90kge jewdq g4rbt fgsgv hha5t g6xgz 98rou j8d7c 98uwe j8d7d 9xgxq jykqs g3zn2 g3z9g b1ipn h4qu3 c8oz2 jhyfz    ".split(" "),l={},u=({text:a,x:b,y:c,color:d=m.B,textAlign:e=
"left",size:f=2,O:h=999})=>{var K=t.g;a||=" ";let x=5*f,n=x+1*f,p=n*a.length,y=a+d+f,L="left"===e?0:"center"===e?p/2:p;if(l[y])a=h*n,K.drawImage(l[y],0,0,a,n,b-L,c,a,n);else{let q=new ImageData(p,x),[S,T,U,V]=g(d);a.replace("!","@").toUpperCase().split("").forEach((z,W)=>{String(parseInt(" "===z?"0":k[z.charCodeAt(0)-35],36).toString(2)).padStart(25,"0").split("").forEach((r,X)=>{if("0"!==r)for(r=0;r<f;r++){var A=X*f;A=4*(W*n+A%x+f*p*Math.floor(A/x)+p*r);for(let F=0;F<f;F++){let B=4*F+A;q.data[B]=
S;q.data[B+1]=T;q.data[B+2]=U;q.data[B+3]=V||255}}})});createImageBitmap(q).then(z=>{l[y]=z;K.drawImage(l[y],b-L,c)})}},m={B:"#2e2622",N:"#cccec7",I:"#77746f",D:"#a09f97"},v=Object.values(m).join("").replace(/#/g,""),w=m.B.repeat(4).replace(/#/g,""),aa="@@@@@@PUUE@PjjjA@ijjF@dZjY@PjjjA@iZeF@djjZ@PUUUAPijjFPdjjZQPUUUQ@TUUA@PA@E@@@@T@@@@PA@ @@@@@@PUUE@PjjjA@ijjF@dZjY@PjjjA@iZeF@djjZ@PUUUAPijjFPdjjZQPUUUQ@TUUA@@E@E@@T@T@@@@PA@ @@@@@@PUUE@PjjjA@ijjF@dZjY@PjjjA@iZeF@djjZ@PUUUAPijjFPdjjZQPUUUQ@TUUA@@EPA@@T@E@@PA@@@ @@@@@@PUUE@PjjjA@ijjF@dZjY@PjjjA@iZeF@djjZ@PUUUAPijjFPdjjZQPUUUQ@TUUA@@EPA@@T@@@@PA@@@ @@@@@@PUUE@PjjjA@ijjF@dZjY@PjjjA@iZeF@djjZ@PUUUAPijjFPdjjZQPUUUQ@TUUA@@E@E@@T@T@@PA@@@ @@@@@@PUUE@PjjjA@ijjF@dZjY@PjjjA@iZeF@djjZ@PUUUAPijjFPdjjZQPUUUQ@TUUA@@E@E@@T@T@@@@PA@".split(" ");
function C(a,b,c=!1,d=!1){var e=t;let f=[];c=c?w:v;[...a].map(h=>{h=h.charCodeAt(0);f.push(h&3);f.push(h>>2&3);f.push(h>>4&3)});a=Math.floor(Math.sqrt(f.length));e.g.save();e.g.translate(b.x+(d?a:0),b.y);e.g.save();e.g.scale(d?-1:1,1);for(b=0;b<a;b++)for(d=0;d<a;d++)if(f[b*a+d]){let h=6*(f[b*a+d]-1);e.g.fillStyle="#"+c.substring(h,h+6);e.g.fillRect(d,b,1,1)}e.g.restore();e.g.restore()}
function D(a,b,c,d){var e=t;e.g.save();e.g.strokeStyle=c;e.g.fillStyle=d;e.g.fillRect(a.x,a.y,b.x,b.y);e.g.strokeRect(a.x+.5,a.y+.5,b.x,b.y);e.g.restore()}class ba{constructor(){this.g=c2d.getContext("2d");let a=()=>{var b=Math.min(window.innerHeight,window.innerWidth);b=Math.max(1,Math.min(b/260,b/320));c2d.style.height=`${260*b}px`;c2d.style.width=`${320*b}px`};window.addEventListener("resize",a);a();c2d.classList.remove("hidden")}}
let t=new ba,ca=[{name:"Dave",C:"So you want to make it big in Hollywood, kid? You better do as I say!",G:"Is that all you got?",M:"I guess you're not totally worthless!",H:"Stop wasting my time kid!",icon:"@@@@@@@UUE@@UUUA@ijjU@dfZZAPjYjE@YiVV@deZYAPjjjF@iUeZ@dZUjA@ijjA@PUUA@TjjZAdjjjZPUUUUA"},{name:"Elena",C:"Just do as you're told and don't get in my way.",G:"Hurry, I don't have all day",M:"Obedient and disciplined. You'll get far, child.",H:"Is there some reason my coffee isn\t here?",icon:"@@@@@@PUUE@PeZUAPijjU@ijjVAeUVYUTjifVQijjZEejjjUPjUjVAijjZ@PjjZ@@TiU@@@dF@@PUVUAPUUUU@"},
{name:"Alfred",C:"Good evening. Are you ready to face your fears?",G:"Time for your final act",M:"Well done. I must admit, you handled the tension admirably.",H:"Was this worth the price of admission?",icon:"@TUU@@djjF@djjjAPUUUF@ijjV@djjjAPVjeF@ijjZ@djjjAPjUjF@djjF@@ejF@@@iF@@TeZU@TUYUEPUUUU@"},{name:"Wally",C:"You come well referenced boy. Let us see what you can do, ha ha.",G:"The wheel must keep spinning, ha ha!",M:"Splendid. I can definitely use you, ha ha!",H:"This just won't do ha ha",icon:"@PA@E@PU@UAPUUUU@UiVUAPijUA@djZA@PfiF@@YfZ@@djjATdjjFPejjZ@djjZ@@UUU@@@@U@@@@UE@@PUUE@"}],
E=[[6,5,3,3,5,5,0,5,-2,0,-2,0,6,3,2,3],[4,3,5,4,3,5,6,4,3,5,4,3,5,6,4,3],[3,2,3,6,0,-2,0,-2,5,0,5,5,3,3,5,6]],da=[[2,3,2.5,4],[4,3.5,3,2.5],[4,2.5,3,2]],ea=(a,b)=>c=>Math.sin(60*Math.pow(10,-(c+1)/2048%8))/8+Math.tan(Math.cbrt(Math.sin(c*a[c>>13&15]/30)))/[2,3,4,6,8,12,16,24][c/[1,1.5][c>>12&1]>>10&7]/32+Math.cbrt(Math.asin(Math.sin(c/b[c>>16&3]/10)))/64;
class fa{constructor(){this.source=null;this.h=[];this.g=new AudioContext;for(let a=0;3>a;a++){let b=E[a%E.length],c=da[a%E.length],d=32E3*(b.length+.4)/2,e=this.g.createBuffer(1,d,32E3),f=e.getChannelData(0);for(let h=0;h<d;h++)f[h]=ea(b,c)(h);this.h.push(e)}}start(){this.g=new AudioContext;this.source=this.g.createBufferSource();this.source.buffer=this.h[0];this.source.connect(this.g.destination);this.source.loop=!0;this.source.start()}}let G;function H(a){var b=I,c=[];b.g=a;b.g.A?.(...c)}
class ha{constructor(...a){this.g=J;this.g.A?.(...a)}}let I;function M(a){return.1>a&&-.1<a?0:a}function ia(a){let b=RegExp("(.{1,40})(\\s|$)","g"),c=[],d;for(;null!==(d=b.exec(a));)c.push(d[1].trim());return c}class ja{constructor(){this.i=this.g=0;this.size={x:16,y:16};this.J={x:0,y:0};this.h=!1}}let N=new ja;
class ka{constructor(){this.l=this.o=this.u=this.s=this.j=this.m=!1;this.g=new Map;this.h={m:this.m,j:this.j,u:this.u,s:this.s,o:this.o,l:this.l};document.addEventListener("keydown",a=>{this.g.set(a.code,!0)});document.addEventListener("keyup",a=>{this.g.set(a.code,!1)});this.i=new DOMPoint}v(a){this.h.m=this.m;this.h.j=this.j;this.h.o=this.o;this.h.l=this.l;let b=this.g.get("KeyA")||this.g.get("ArrowLeft")?-1:0,c=this.g.get("KeyD")||this.g.get("ArrowRight")?1:0,d=this.g.get("KeyW")||this.g.get("ArrowUp")?
-1:0,e=this.g.get("KeyS")||this.g.get("ArrowDown")?1:0;this.i.x=b+c||0;this.i.y=d+e||0;this.m=0>this.i.y;this.j=0<this.i.y;this.s=0>this.i.x;this.u=0<this.i.x;this.o=!!this.g.get("Enter");(this.l=!!this.g.get("Escape"))&&H(J);this.m&&(this.h.m||"function"==typeof a.L&&a.L());this.j&&(this.h.j||"function"==typeof a.K&&a.K());this.u&&(this.h.u||"function"==typeof a.S&&a.S());this.s&&(this.h.s||"function"==typeof a.R&&a.R());this.o&&(this.h.o||"function"==typeof a.F&&a.F());this.l&&(this.h.l||"function"==
typeof a.P&&a.P())}}let O=new ka;
class la{constructor(){this.h={x:0,y:0};this.g={x:0,y:0}}A(){}v(a){O.m?this.g.y-=.02*a:O.j?this.g.y+=.02*a:0<this.g.y?this.g.y=Math.max(0,this.g.y-.02*a):0>this.g.y&&(this.g.y=Math.min(0,this.g.y+.02*a));O.s?(this.g.x-=.02*a,N.h=!0):O.u?(this.g.x+=.02*a,N.h=!1):0<this.g.x?this.g.x=Math.max(0,this.g.x-.02*a):0>this.g.x&&(this.g.x=Math.min(0,this.g.x+.02*a));this.h={x:Math.round(this.h.x+this.g.x),y:Math.round(this.h.y+this.g.y)};this.g={x:M(Math.max(Math.min(this.g.x,3),-3)),y:M(Math.max(Math.min(this.g.y,
3),-3))};N.J=this.h;0!=this.g.x||0!=this.g.y?(N.g+=a,60<=N.g&&(N.i=(N.i+1)%6,N.g-=60),C(aa[N.i],N.J,!1,N.h)):C("@@@@@@PUUE@PjjjA@ijjF@dZjY@PjjjA@iZeF@djjZ@PUUUAPijjFPdjjZQPUUUQ@TUUA@PA@E@@E@T@@T@PA@",N.J,!1,N.h)}}
class ma{constructor(){this.h=this.g=0}A(){}v(a){this.g+=a;30<=this.g&&(this.h++,this.g-=30);D({x:5,y:c2d.height-70},{x:c2d.width-10,y:50},m.D,m.N);D({x:8,y:c2d.height-67},{x:c2d.width-16,y:44},m.D,m.N);let {name:b,C:c,icon:d}=ca[0];u({text:b,x:12,y:c2d.height-63,size:2,color:m.I});ia(c).forEach((e,f)=>{u({text:e,x:12,y:c2d.height-45+8*f,size:1,O:this.h-40*f})});t.g.save();t.g.translate(c2d.width-45,c2d.height-60);t.g.save();t.g.scale(2,2);C(d,{x:0,y:0});t.g.restore();t.g.restore()}F(){H(new la)}}
let P=[[" Story mode",80],[" Endless mode",160]];
class na{constructor(){this.g=0}A(){this.g=0;G&&G?.source?.stop()}v(){u({text:"Levels",x:c2d.width/2,y:30,textAlign:"center",color:m.I,size:3});let a=c2d.width/2-84;[...P,["&",0===this.g?P[0][1]:P[1][1]]].forEach(([b,c])=>{u({text:b,x:a-10,y:c,color:m.B,size:2})});u({text:"Press ENTER to start",x:c2d.width/2,y:c2d.height-20,textAlign:"center",color:m.I,size:1});t.g.save();t.g.translate(a,100);["@@@@@@@UUE@@UUUA@ijjU@dfZZAPjYjE@YiVV@deZYAPjjjF@iUeZ@dZUjA@ijjA@PUUA@TjjZAdjjjZPUUUUA","@@@@@@PUUE@PeZUAPijjU@ijjVAeUVYUTjifVQijjZEejjjUPjUjVAijjZ@PjjZ@@TiU@@@dF@@PUVUAPUUUU@",
"@TUU@@djjF@djjjAPUUUF@ijjV@djjjAPVjeF@ijjZ@djjjAPjUjF@djjF@@ejF@@@iF@@TeZU@TUYUEPUUUU@","@PA@E@PU@UAPUUUU@UiVUAPijUA@djZA@PfiF@@YfZ@@djjATdjjFPejjZ@djjZ@@UUU@@@@U@@@@UE@@PUUE@"].forEach((b,c)=>{t.g.save();t.g.scale(2,2);c={x:21*c,y:0};D(c,{x:16,y:16},"transparent",m.D);C(b,c,!0);t.g.restore()});t.g.restore()}L(){console.log("up");this.g--;0>this.g&&(this.g=P.length-1)}K(){console.log("down");this.g++;this.g>P.length-1&&(this.g=0)}F(){0===this.g&&H(new ma)}}
let oa=new na,Q=["new game","continue","levels","about"];class pa{constructor(){this.g=0}A(){G&&G?.source?.stop()}v(){Q.forEach((a,b)=>{u({text:a,x:c2d.width/2,y:80+16*b,textAlign:"center",color:b===this.g?m.B:m.D})})}L(){console.log("up");this.g--;0>this.g&&(this.g=Q.length-1)}K(){console.log("down");this.g++;this.g>Q.length-1&&(this.g=0)}F(){0===this.g&&H(oa)}}let J=new pa;document.querySelector('link[type="image/x-icon"]').href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E\ud83c\udf9e%3C/text%3E%3C/svg%3E";
I=new ha(...[]);let R=0,Y=[];G=new fa;function Z(a){let b=a-R;R=a;Y.push(1E3/b);15===Y.length&&(fps.innerHTML=`${Math.round(Y.reduce((c,d)=>c+d)/15)} FPS`,Y=[]);t.g.clearRect(0,0,c2d.width,c2d.height);a=I.g;O.v(a);a.v(b);requestAnimationFrame(Z)}requestAnimationFrame(Z);
